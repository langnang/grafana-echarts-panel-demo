"use strict";System.register(["app/plugins/sdk","./libs/echarts.min","./style.css!"],function(a,b){function c(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g,h,i,j;return{setters:[function(a){g=a.MetricsPanelCtrl},function(a){h=a["default"]},function(a){}],execute:function(){i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),a("Controller",j=function(a){function b($scope,$injector){d(this,b);var a=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,$scope,$injector)),c={IS_UCD:!1,url:"",method:"POST",upInterval:6e4,format:"Year",columns:[],chartsOption:{xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value"},series:[{type:"line",data:[],smooth:!1}]},_chartsOption:{xAxis:{columns:[],dataColumn:""},series:{line:{areaStyle:!1,columns:[],dataColumn:""}}},log:!1};return _.defaults(a.panel,c),a.panel.log&&console.log(a),a.panel.log&&console.log(_),a.events.on("data-received",a.onDataReceived.bind(a)),a.events.on("data-error",a.onDataError.bind(a)),a.events.on("data-snapshot-load",a.onDataReceived.bind(a)),a.events.on("init-edit-mode",a.onInitEditMode.bind(a)),a.events.on("panel-initialized",a.render.bind(a)),a.refreshData(),a}return f(b,a),i(b,[{key:"onDataReceived",value:function(a){var b=this;this.panel.log&&console.log(a);var d=a[0];this.panel.columns=[].concat(c(d.columns.map(function(a){return a.text})),[""]),this.panel.log&&console.log(this.panel.columns),this.panel._chartsOption.xAxis.columns=this.panel.columns.filter(function(a){return a!=b.panel._chartsOption.series.line.dataColumn}),this.panel.log&&console.log(this.panel._chartsOption.xAxis.columns),this.panel._chartsOption.series.line.columns=this.panel.columns.filter(function(a){return a!=b.panel._chartsOption.xAxis.dataColumn}),this.panel.log&&console.log(this.panel._chartsOption.series.line.columns),this.panel.chartsOption.xAxis.data=d.rows.map(function(a){return b.panel.columns.indexOf(b.panel._chartsOption.xAxis.dataColumn)==b.panel.columns.length-1?null:a[b.panel.columns.indexOf(b.panel._chartsOption.xAxis.dataColumn)]}),this.panel.log&&console.log(this.panel.chartsOption.xAxis.data),this.panel.chartsOption.series[0].data=d.rows.map(function(a){return b.panel.columns.indexOf(b.panel._chartsOption.series.line.dataColumn)==b.panel.columns.length-1?null:a[b.panel.columns.indexOf(b.panel._chartsOption.series.line.dataColumn)]}),this.panel.log&&console.log(this.panel.chartsOption.series[0].data),this.panel._chartsOption.series.line.areaStyle?this.panel.chartsOption.series[0].areaStyle={}:delete this.panel.chartsOption.series[0].areaStyle,this.panel.log&&console.log(this.panel.chartsOption),this.panel.log&&console.log(this.panel._chartsOption),this.refreshed=!0,this.render(),this.refreshed=!1}},{key:"onDataError",value:function(a){this.render()}},{key:"onInitEditMode",value:function(){this.addEditorTab("Options","public/plugins/echarts-panel-demo/partials/options.html",2),this.addEditorTab("Dev","public/plugins/echarts-panel-demo/partials/dev.html",3)}},{key:"refreshData",value:function(){var a=this,b=this,c=void 0;c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&(b.customizeData=JSON.parse(c.responseText),b.onDataReceived())},this.panel.IS_UCD?(c.open(b.panel.method,b.panel.url,!0),c.send()):c=null,this.$timeout(function(){a.refreshData()},b.panel.upInterval)}},{key:"link",value:function(a,b,c,d){function e(){var a=d.height||panel.height||d.row.height;_.isString(a)&&(a=parseInt(a.replace("px",""),10)),a+=0,g.style.height=a+"px"}function f(){if(i&&(e(),i.resize(),d.refreshed)){i.clear(),d.panel.log&&console.log(d.panel.chartsOption);var a=d.panel.chartsOption;d.panel.log&&console.log(a),i.setOption(a)}}d.panel.log&&console.log(a),d.panel.log&&console.log(b),d.panel.log&&console.log(c),d.panel.log&&console.log(d);var g=b.find(".echarts_container")[0];d.refreshed=!0,e();var i=h.init(g,"dark");setTimeout(function(){i.resize()},1e3),this.events.on("render",function(){f(),d.renderingCompleted()})}}]),b}(g)),a("Controller",j),j.templateUrl="partials/module.html"}}});
//# sourceMappingURL=controller.js.map